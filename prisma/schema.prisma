generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Definice rolí pro uživatele
enum Role {
  USER
  ADMIN
}

// Datový model pro uživatele
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  role      Role     @default(USER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Vztah: Uživatel může přidat více videí
  videos      Video[]
  // Sbírky vytvořené uživatelem
  collections Collection[]
}

model Video {
  id        String   @id @default(cuid())
  youtubeId String   @unique // ID videa z URL (např. "dQw4w9WgXcQ")
  title     String   // Manuálně zadaný název
  summary   String   @db.Text // Manuálně zadané shrnutí (delší text)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Propojení na autora
  authorId  String
  author    User     @relation(fields: [authorId], references: [id])

  chapters    Chapter[]
  // Relace M:N (Video může být ve více sbírkách)
  collections Collection[]
  // Relace 1:1 na přepis
  transcript  Transcript?

  // --- NOVÁ SEO POLE (Fáze 12) ---
  seoSummary     String?   @db.Text  // AI Abstrakt (kontext + řešení)
  seoKeywords    String[]  // Klíčová slova (entity, látky, diagnózy)
  practicalTips  String[]  // Konkrétní rady (Actionable items)
  aiSuggestions  String[]  // Návrhy názvů sbírek
}

model Chapter {
  id        String   @id @default(cuid())
  text      String   // Zobrazený text (např. "1.1. Úvod...")
  startTime Int      // Čas "od" v sekundách
  endTime   Int?     // Čas "do" v sekundách (nepovinné)
  level     Int      // Úroveň zanoření (0 = kořen, 1 = podkapitola)
  order     Int      // Pořadí kapitoly v rámci videa

  // Relace k videu. Při smazání videa se smažou i kapitoly.
  video   Video  @relation(fields: [videoId], references: [id], onDelete: Cascade)
  videoId String
}

// Model pro sbírky videí
model Collection {
  id          String   @id @default(cuid())
  name        String
  description String?  @db.Text
  isPublic    Boolean  @default(false) // Příznak viditelnosti
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Vlastnictví (RBAC)
  authorId    String
  author      User     @relation(fields: [authorId], references: [id])

  // Vztah M:N s videi
  videos      Video[]
}

// Model pro přepisy videí
model Transcript {
  id          String   @id @default(cuid())
  
  // Relace 1:1 na Video
  videoId     String   @unique
  video       Video    @relation(fields: [videoId], references: [id], onDelete: Cascade)
  
  // Obsah
  content     String   @db.Text      // Surový text titulků spojený do jednoho bloku
  fullData    Json?                  // Kompletní JSON s časovými značkami (pro budoucí AI)
  language    String   @default("cs") // Jazyk titulků
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}