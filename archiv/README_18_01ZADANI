J√Å_PROMPT:
V p≈ô√≠loze jsou dokumenty z posledn√≠ch 10 f√°z√≠ realizace jedn√© webov√© aplikace zab√Ωvaj√≠c√≠ se spr√°vou internetov√©ho obsahu resp. vide√≠ z youtube. Principem je ≈æe u≈æivatel t√©to aplikace si vytv√°≈ô√≠ vlastn√≠ knihovnu vide√≠, videa analyzuje, t≈ô√≠d√≠ jejich obsah a vytv√°≈ô√≠ si sb√≠rky t√©mat s tƒõmito videi. Aplikace je ve f√°zi kdy je aplikaci v p≈ôedchoz√≠ f√°zi poskytnut z√°kladn√≠ UX design resp. design pro z√≠sk√°v√°n√≠ u≈æivatel≈Ø t√©to aplikace - v t√©to f√°zi jsou zat√≠m k dispozici u≈æivatelsk√° pr√°va z jedn√© strany pro admina z druh√© strany pro usera resp. admin m≈Ø≈æe p≈ôid√°vat videa a vytv√°≈ôet sb√≠rky a user m≈Ø≈æe pouze prohl√≠≈æet zve≈ôejnƒõn√Ω obsah resp. sb√≠rky a videa za≈ôazen√° do ve≈ôejn√Ωch sb√≠rek. Tato aplikace p≈ôedpokl√°d√° vytvo≈ôen√≠ u≈æivatele s pr√°vy "Kurator" co≈æ bude u≈æivatel, kter√Ω bude moci vytv√°≈ôet rovnƒõ≈æ obsah resp. p≈ôid√°vat videa a vytv√°≈ôet sb√≠rky stejnƒõ jako nyn√≠ Admin. Admin ov≈°em bude moci rovnƒõ≈æ spravovat u≈æivatele resp. bude moci u≈æivatel≈Øm s pr√°vy user p≈ôidƒõlovat pr√°va "Kurator" ƒçi vytv√°≈ôet u≈æivatele User. Resp. tato f√°ze v√°voje aplikace ƒç√≠slo 18 se bude zab√Ωvat vytvo≈ôen√≠m prost≈ôed√≠ pro vznik pr√°v "Kurator" v t√©to aplikaci. To bude spojeno s pot≈ôebou vytvo≈ôit adminovi spr√°nku pro Spr√°vu u≈æivatel≈Ø, kde bude seznam u≈æivatel≈Ø s uveden√≠m jejich pr√°v, p≈ôiƒçem≈æ tato pr√°va bude mo≈æn√© editovat t√≠m ≈æe bude mo≈æn√© vytv√°≈ôet nov√© u≈æivatele nejprve jako u≈æivatel s pr√°vy user kter√©mu pot√© bude mo≈æn√© p≈ôidat pr√°vo i "Kurator". Pot√© v aplikaci bude nadefinov√°no resp. implementov√°no toto pr√°vo "Kurator", kter√Ω bude moci p≈ôid√°vat videa (tlaƒç√≠tko p≈ôidat video "+ Video"), bude moci vidƒõt str√°nku "P≈ôehled obsahu", kde budou ov≈°em pouze videa p≈ôidan√° t√≠tmo u≈æivatelem s pr√°vy "Kur√°tor" (resp. ADMIN m≈Ø≈æe na t√©to str√°nce vidƒõt videa v≈°ech u≈æivatel≈Ø), bude moci vidƒõt str√°nku "Spr√°va obsahu", kde budou v seznamu rovnƒõ≈æ pouze videa tohoto u≈æivatele resp Kur√°tora (resp. admin vid√≠ v≈°echny videa) a bude moci vidƒõt str√°nku "Sbirky" ale opƒõt pouze se sv√Ωmi sb√≠rkami (resp. Admin vid√≠ opƒõt sb√≠rky v≈°ech u≈æivatel≈Ø) ... resp. Kurator vid√≠ stejn√© str√°nky jako admin ale s obsahem kter√Ω pat≈ô√≠ jen Kur√°torovi. Rovnƒõ≈æ Kur√°tor neuvid√≠ novou str√°nku "Spr√°va u≈æivatel≈Ø", kter√° bude z≈Øst√°vat zat√≠m pouze adminovi (do budoucna je mo≈æn√© ≈æe tuto str√°nku uvid√≠ i kur√°to≈ôi kte≈ô√≠ budou moci p≈ôid√°vat i sv√© u≈æivatele resp. kur√°tory). Resp. jako USER se m≈Ø≈æe zaregistrovat kdokoliv, ale zat√≠m pouze admin bude moci p≈ôid√°vat USER≈Øm i pr√°va Kurator. Takto se tato webov√° str√°nka stane onou aplikac√≠ kde kur√°to≈ôi budou vytv√°≈ôet sv√© ostrovy sledovan√©ho obsahu na internetu a ten i sd√≠let s ostatn√≠mi. Pojdme pros√≠m nyn√≠ nejprve prodiskutovat tyto po≈æadavky na toto nov√© zad√°n√≠ ƒç. 18 zda nesk√Ωtaj√≠ tyto  po≈æadavky nƒõjak√° slab√° m√≠sta vzhledem k postaven√≠ a vystavƒõn√≠ souƒçasn√© aplikace tak abychom vytvo≈ôili kvalitn√≠ zad√°n√≠ i s ohledem na best practice v oblasti ≈ô√≠zen√≠ pr√°v v aplikaci. V√Ωsledkem by mƒõlo b√Ωt zad√°n√≠ kter√© jednak bude implementovat tuto mo≈ænost vytvo≈ôit pr√°va Kurator v t√©to apluikaci fakticky ale i sled √∫kon≈Ø jak√Ωm tato pr√°va maj√≠ b√Ωt v aplikaci realizov√°na. nejprve pojdme prodiskutovat a vytvo≈ôit toto zad√°n√≠ a teprve po vytvo≈ôen√≠ tohoto zad√°n√≠ se bude diskutovat a realizovat realizaƒçn√≠ pl√°n pro toto zad√°n√≠ kter√Ω se teprve pot√© bude tak√© samostatnƒõ realizovat resp. pojdme postupovat v souladu s na≈°√≠m v√Ωvojov√Ωm cyklem v t√©to aplikaci. Pro √∫ƒçely vytvo≈ôen√≠ tohoto dal≈°√≠ho zad√°n√≠ jsou v p≈ô√≠loze tedy k dispozici p≈ôedchoz√≠ch deset zad√°n√≠ t√©to aplikace. [README_08_01ZADANI][README_09_01ZADANI][README_10_01ZADANI][README_11_01ZADANI][README_12_01ZADANI][README_13_01ZADANI][README_14_01ZADANI][README_15_01ZADANI][README_16_01ZADANI][README_17_01ZADANI]


AI_RESPONZE:
To je naprosto z√°sadn√≠ moment v ≈æivotƒõ aplikace. üöÄ P≈ôech√°z√≠me z "Single-Player" re≈æimu (kde jste byl jedin√Ωm tv≈Ørcem vy) do "Multi-Player" re≈æimu (platforma pro komunitu kur√°tor≈Ø).

To s sebou nese nutnost zmƒõnit my≈°len√≠ z "J√° vid√≠m v≈°echno" na "Ka≈æd√Ω vid√≠ jen sv√© p√≠skovi≈°tƒõ, ale Admin vid√≠ cel√© h≈ôi≈°tƒõ".

P≈ôedt√≠m, ne≈æ sep√≠≈°u fin√°ln√≠ zad√°n√≠, pojƒème prodiskutovat t≈ôi kl√≠ƒçov√° m√≠sta (Best Practices), kter√° mus√≠me v zad√°n√≠ o≈°et≈ôit, aby to bylo bezpeƒçn√© a robustn√≠:

1. Princip "Server-Side Data Isolation" (Bezpeƒçnost)
Nestaƒç√≠ jen skr√Ωt tlaƒç√≠tka v menu.

Riziko: Pokud by Kur√°tor uhodl URL /admin/edit/VIDEO_ID_JINEHO_KURATORA, nesm√≠ se mu str√°nka otev≈ô√≠t.

Best Practice: V≈°echny datab√°zov√© dotazy (Prisma queries) pro Kur√°tora mus√≠ m√≠t "natvrdo" p≈ôidanou podm√≠nku where: { authorId: session.user.id }.

Admin: Admin tuto podm√≠nku nem√° (vid√≠ v≈°e).

Z√°vƒõr do zad√°n√≠: Mus√≠me explicitnƒõ definovat, ≈æe filtrace obsahu prob√≠h√° na backendu, nikoliv jen na frontendu.

2. Spr√°va U≈æivatel≈Ø (User Management)
Admin pot≈ôebuje jednoduch√Ω n√°stroj na "povy≈°ov√°n√≠".

N√°vrh: Jednoduch√° tabulka: Jm√©no | Email | Role (Dropdown) | Akce.

Proces: U≈æivatel se zaregistruje s√°m (jako USER). Vy ho v tabulce uvid√≠te a zmƒõn√≠te roli na KURATOR.

Best Practice: Je dobr√© zabr√°nit tomu, abyste si omylem odebral roli ADMIN s√°m sobƒõ (tzv. "suicide prevention check" v k√≥du).

3. Viditelnost ve ve≈ôejn√© ƒç√°sti (Katalog)
Ot√°zka: Kdy≈æ Kur√°tor vytvo≈ô√≠ sb√≠rku a d√° j√≠ isPublic: true, objev√≠ se automaticky na Homepage?

P≈ôedpoklad: Ano, platforma m√° b√Ωt demokratick√°. "Ostrov" kur√°tora je jeho soukrom√° spr√°va, ale jeho ve≈ôejn√© sb√≠rky jsou souƒç√°st√≠ spoleƒçn√©ho "Mo≈ôe".

Pokud s tƒõmito body souhlas√≠te, zde je p≈ôipraven√© kompletn√≠ zad√°n√≠ pro F√°zi 18. Je koncipov√°no tak, aby zavedlo robustn√≠ RBAC (Role-Based Access Control).

README_18_01ZADANI
üìú Zpr√°va o genezi zad√°n√≠ (Development Report)
T√©ma: F√°ze 18 ‚Äì Spr√°va U≈æivatel≈Ø a Role Kur√°tor (Multi-tenancy) Datum vzniku: 6. prosince 2025 Kontext: Dosud byla aplikace syst√©mem pro jednoho spr√°vce (Admina). Aby se mohla st√°t komunitn√≠ platformou ("Ostrovem vƒõdƒõn√≠"), je nutn√© umo≈ænit tvorbu obsahu i dal≈°√≠m d≈Øvƒõryhodn√Ωm u≈æivatel≈Øm (Kur√°tor≈Øm), ani≈æ by mƒõli pln√Ω p≈ô√≠stup k syst√©mu.

1. Definice Rol√≠ (RBAC Matrix)
Bƒõhem anal√Ωzy byly definov√°ny ƒçty≈ôi √∫rovnƒõ p≈ô√≠stupu:

VISITOR (N√°v≈°tƒõvn√≠k): Prohl√≠≈æ√≠ ve≈ôejn√Ω katalog a videa. Nem√° √∫ƒçet.

USER (U≈æivatel): M√° √∫ƒçet. M≈Ø≈æe si (v budoucnu) ukl√°dat obl√≠ben√©. Nem≈Ø≈æe tvo≈ôit obsah.

KURATOR (Tv≈Ørce): M√° p≈ô√≠stup do Admin sekce. M≈Ø≈æe p≈ôid√°vat videa a tvo≈ôit sb√≠rky. Vid√≠ a edituje POUZE sv≈Øj vlastn√≠ obsah.

ADMIN (Spr√°vce): M√° pln√Ω p≈ô√≠stup. Vid√≠ obsah v≈°ech Kur√°tor≈Ø. Spravuje u≈æivatele a p≈ôidƒõluje role.

2. Architektonick√° v√Ωzva: Izolace dat
Kl√≠ƒçov√Ωm bodem zad√°n√≠ nen√≠ jen UI, ale bezpeƒçnost dat.

Byl p≈ôijat princip "Author Ownership".

Ka≈æd√Ω dotaz do datab√°ze v sekci /admin (kromƒõ Admina) mus√≠ b√Ωt filtrov√°n podle authorId.

3. Workflow povy≈°ov√°n√≠
Byl zvolen manu√°ln√≠ model:

Registrace je otev≈ôen√° (default = USER).

Pov√Ω≈°en√≠ na KURATORA prov√°d√≠ Admin ruƒçnƒõ v nov√© sekci "Spr√°va u≈æivatel≈Ø". T√≠m je zaji≈°tƒõna kontrola kvality kur√°tor≈Ø.

üìÑ Zad√°n√≠ projektu: Webov√° aplikace Mediathek (F√°ze 18 - Role Kur√°tor a Spr√°va u≈æivatel≈Ø)
Datum: 6. prosince 2025 Verze: 18.0 Navazuje na: F√°ze 17 (Showcase), F√°ze 9 (P≈ô√≠prava rol√≠ - zm√≠nƒõno)

1. N√°zev projektu
Mediathek ‚Äì Implementace Kur√°torsk√Ωch Pr√°v

2. üéØ C√≠l F√°ze
C√≠lem je transformovat aplikaci na multi-u≈æivatelskou platformu. Zavedeme roli KURATOR, kter√° umo≈æn√≠ vybran√Ωm u≈æivatel≈Øm spravovat vlastn√≠ videa a sb√≠rky, a vytvo≈ô√≠me rozhran√≠ pro ADMINA pro spr√°vu tƒõchto rol√≠. Z√°sadn√≠m principem je izolace obsahu: Kur√°tor v administraci vid√≠ jen to, co s√°m vytvo≈ôil, zat√≠mco Admin m√° glob√°ln√≠ p≈ôehled.

3. Rozsah pro F√°zi 18
Datab√°ze: Ovƒõ≈ôen√≠/√öprava modelu User (pole role mus√≠ podporovat enum KURATOR).

Backend (RBAC): √öprava API endpoint≈Ø a Server Actions pro videa a sb√≠rky.

Implementace podm√≠nky: IF Role != ADMIN THEN Filter by AuthorID.

Frontend (Admin - Spr√°va u≈æivatel≈Ø):

Nov√° str√°nka /admin/users.

Tabulka u≈æivatel≈Ø s mo≈ænost√≠ zmƒõny role.

Frontend (Dashboard a Seznamy):

√öprava str√°nek /admin/dashboard, /admin/videos, /admin/collections.

Filtrov√°n√≠ zobrazen√Ωch dat podle role p≈ôihl√°≈°en√©ho u≈æivatele.

Frontend (Navigace):

Skryt√≠ polo≈æky "U≈æivatel√©" v menu pro ne-adminy.

4. üèõÔ∏è N√°vrh ≈òe≈°en√≠ a Architektura
4.1. Spr√°va U≈æivatel≈Ø (/admin/users)
P≈ô√≠stup: POUZE role ADMIN.

UI: Tabulka (Data Grid).

Sloupce: Avatar, Jm√©no, Email, Role (Select/Dropdown), Datum registrace.

Akce: Zmƒõna role v dropdownu okam≈æitƒõ (nebo po potvrzen√≠) vol√° API updateUserRole.

Validace: Admin nesm√≠ (omylem) odebrat roli Admin s√°m sobƒõ.

4.2. Logika izolace dat (Dashboard & Lists)
Logika naƒç√≠t√°n√≠ dat (nap≈ô. v prisma.video.findMany) se zmƒõn√≠ n√°sledovnƒõ:

TypeScript

// Pseudo-k√≥d logiky na serveru
const session = await getServerSession();
const userRole = session.user.role;
const userId = session.user.id;

let whereCondition = {};

if (userRole === 'KURATOR') {
  // Kur√°tor vid√≠ jen sv√©
  whereCondition = { authorId: userId };
} 
// Admin m√° whereCondition pr√°zdnou (vid√≠ v≈°e)

const videos = await prisma.video.findMany({
  where: whereCondition
});
Tato logika mus√≠ b√Ωt aplikov√°na na:

/admin/dashboard (p≈ôehled vide√≠)

/admin/collections (p≈ôehled sb√≠rek)

/admin/videos (spr√°va vide√≠)

4.3. Editace a Maz√°n√≠ (Security)
Str√°nky /admin/edit/[id] a /admin/collections/edit/[id] mus√≠ ovƒõ≈ôit vlastnictv√≠.

Pokud se Kur√°tor pokus√≠ p≈ôistoupit na ID, kter√© mu nepat≈ô√≠ (nap≈ô. p≈ôes URL), mus√≠ dostat chybu 403 Forbidden nebo 404 Not Found.

5. üö¶ Funkƒçn√≠ Po≈æadavky (FR)
FR1 (User Management): Admin vid√≠ seznam v≈°ech registrovan√Ωch u≈æivatel≈Ø a m≈Ø≈æe mƒõnit jejich roli (USER <-> KURATOR <-> ADMIN).

FR2 (Curator View): Kur√°tor po p≈ôihl√°≈°en√≠ do adminu vid√≠ v seznamech vide√≠ a sb√≠rek pouze polo≈æky, kde authorId == curatorId.

FR3 (Admin View): Admin vid√≠ v seznamech polo≈æky v≈°ech autor≈Ø. (Ide√°lnƒõ s informac√≠ ve sloupci "Autor", aby poznal, ƒç√≠ to je).

FR4 (Creation): Kur√°tor m≈Ø≈æe vytv√°≈ôet nov√° videa a sb√≠rky. Tyto polo≈æky se automaticky ulo≈æ√≠ s jeho authorId.

FR5 (Menu Protection): Polo≈æka menu "U≈æivatel√©" je viditeln√° pouze pro roli ADMIN.

6. üîí Nefunkƒçn√≠ Po≈æadavky (NFR)
NFR1 (Bezpeƒçnost): API endpointy pro zmƒõnu role mus√≠ striktnƒõ vy≈æadovat session s rol√≠ ADMIN.

NFR2 (Konzistence): UI pro Kur√°tora vypad√° stejnƒõ jako pro Admina (stejn√Ω layout), jen s m√©nƒõ daty a m√©nƒõ polo≈ækami v menu.

7. ‚úÖ Akceptaƒçn√≠ Kriteria (Definice "Hotovo")
Sc√©n√°≈ô: Pov√Ω≈°en√≠

U≈æivatel "Jan" se zaregistruje. M√° roli USER. Nem≈Ø≈æe do /admin.

Admin jde na /admin/users, najde Jana a zmƒõn√≠ roli na KURATOR.

Jan se odhl√°s√≠/p≈ôihl√°s√≠ (nebo refreshne) a nyn√≠ m√° p≈ô√≠stup do /admin.

Sc√©n√°≈ô: Izolace

Kur√°tor Jan p≈ôid√° video "Moje K√°va".

Admin p≈ôid√° video "Admin≈Øv ƒåaj".

Jan v seznamu vid√≠ jen "Moje K√°va".

Admin v seznamu vid√≠ "Moje K√°va" i "Admin≈Øv ƒåaj".

Sc√©n√°≈ô: Ochrana

Jan zkus√≠ do adresn√≠ho ≈ô√°dku zadat ID videa "Admin≈Øv ƒåaj".

Aplikace mu zobraz√≠ chybu "Nem√°te opr√°vnƒõn√≠" nebo ho p≈ôesmƒõruje.

Je tento n√°vrh v souladu s va≈°√≠ viz√≠? Pokud ano, m≈Ø≈æeme to pova≈æovat za schv√°len√© zad√°n√≠ pro F√°zi 18 a p≈ôej√≠t k pl√°nov√°n√≠ realizace.


------------------------------------------------------------------------

J√Å_PROMPT:
Pojdme toto zad√°n√≠ je≈°tƒõ radƒõji zrevidovat v kontextu p≈ôedchoz√≠ch zad√°n√≠ 00 a≈æ 07, tak abychom jasnƒõ zformulovali toto zad√°n√≠ v kontextu ≈ôe≈°en√≠ pr√°v ve v≈°ech f√°z√≠ch v√Ωvoje t√©to aplikace a zku≈°enost√≠ s nimi. [README_00_01ZADANI][README_01_01ZADANI][README_02_01ZADANI][README_03_01ZADANI][README_04_01ZADANI][README_05_01ZADANI][README_06_01ZADANI][README_07_01ZADANI]


AI_RESPONZE:
To je velmi moudr√Ω krok. Pod√≠vat se zpƒõtnƒõ na "genetick√Ω k√≥d" aplikace (F√°ze 00‚Äì07) n√°m zajist√≠, ≈æe F√°ze 18 nebude "ciz√≠m tƒõlesem", ale logick√Ωm vyvrcholen√≠m dosavadn√≠ architektury.

Pro≈°el jsem detailnƒõ historii ≈ôe≈°en√≠ pr√°v a bezpeƒçnosti v dokumentech 00‚Äì07. Zde je **anal√Ωza kontextu** a n√°slednƒõ **revidovan√© zad√°n√≠**.

### üîç Anal√Ωza v√Ωvoje pr√°v (Pouƒçen√≠ z F√°z√≠ 00‚Äì07)

Kdy≈æ se pod√≠v√°me na historii, vid√≠me jasnou evoluci, kterou F√°ze 18 mus√≠ respektovat:

1.  **F√°ze 1 (Identita):** Zavedli jsme `NextAuth` a model `User`.
      * *Pouƒçen√≠:* Identita je vy≈ôe≈°ena. F√°ze 18 nesm√≠ mƒõnit *jak* se p≈ôihla≈°ujeme, jen *co* s tou identitou dƒõl√°me.
2.  **F√°ze 2 (Ochrana tras):** Zavedli jsme `middleware.ts`, kter√Ω chr√°n√≠ `/admin`.
      * *Pouƒçen√≠:* Ochrana je na √∫rovni URL. F√°ze 18 mus√≠ zajistit, aby Kur√°tor *mohl* do `/admin`, ale nevidƒõl to co Admin.
3.  **F√°ze 3+4 (Server-Side Fetching):** Zavedli jsme RSC (React Server Components).
      * *Pouƒçen√≠:* Data se filtruj√≠ na serveru. F√°ze 18 nesm√≠ filtrovat data jen v prohl√≠≈æeƒçi (skr√Ωt tlaƒç√≠tko), ale mus√≠ upravit Prisma dotazy (`where: { authorId: ... }`).
4.  **F√°ze 6+7 (Zlomov√Ω bod - Vlastnictv√≠):** Zde jsme zavedli logiku `isOwner || isAdmin` a pole `authorId` u Vide√≠ a Sb√≠rek.
      * *Kl√≠ƒçov√Ω moment:* **Technologie pro Kur√°tora u≈æ v aplikaci existuje.** Byla vyvinuta v F√°zi 7, jen nebyla aktivn√≠, proto≈æe v≈°ichni auto≈ôi byli z√°rove≈à Admini.
      * *C√≠l F√°ze 18:* Pouze "zapnout" tuto existuj√≠c√≠ logiku pro novou roli.

-----

### üèõÔ∏è Revidovan√© Zad√°n√≠ (S d≈Ørazem na kontinuitu)

Toto zad√°n√≠ je preciznƒõj≈°√≠ v tom, ≈æe nedefinuje vƒõci znovu, ale odkazuje na mechanismy vytvo≈ôen√© v minul√Ωch f√°z√≠ch.

# README\_18\_01ZADANI

## üìú Zpr√°va o genezi zad√°n√≠ (Development Report)

**T√©ma:** F√°ze 18 ‚Äì Aktivace Multi-tenant architektury (Role Kur√°tor)
**Kontext:** Aplikace technicky dospƒõla. V F√°z√≠ch 6 a 7 jsme implementovali "vlastnictv√≠ dat" (`authorId`). Nyn√≠ tuto architekturu vyu≈æijeme pro zaveden√≠ delegovan√© spr√°vy obsahu.

### 1\. Kontinuita pr√°v (Best Practices z F√°z√≠ 0-7)

P≈ôi revizi jsme identifikovali, ≈æe nen√≠ t≈ôeba ps√°t nov√Ω bezpeƒçnostn√≠ syst√©m.

  * **Autorizace:** Vyu≈æijeme existuj√≠c√≠ RBAC logiku (`isOwner`) z F√°ze 7.
  * **Ochrana:** Vyu≈æijeme existuj√≠c√≠ Middleware z F√°ze 2, pouze roz≈°√≠≈ô√≠me definici "opr√°vnƒõn√©ho u≈æivatele" pro `/admin` sekci.

### 2\. Up≈ôesnƒõn√≠ "≈Ωivotn√≠ho cyklu u≈æivatele"

Definovali jsme tok povy≈°ov√°n√≠, aby byl bezpeƒçn√Ω:

  * Registrace -\> `USER` (vid√≠ jen ve≈ôejn√©).
  * Admin akce -\> `KURATOR` (vid√≠ `/admin`, ale jen sv√° data).
  * Admin akce -\> `ADMIN` (vid√≠ v≈°e).

-----

## üìÑ Zad√°n√≠ projektu: Webov√° aplikace Mediathek (F√°ze 18 - Spr√°va rol√≠ a U≈æivatel≈Ø)

**Datum:** 6. prosince 2025
**Verze:** 18.1 (Revidovan√°)
**Navazuje na:** F√°ze 7 (Implementace Sb√≠rek a authorId), F√°ze 17 (Showcase)

### 1\. N√°zev projektu

Mediathek ‚Äì Implementace Kur√°torsk√Ωch Pr√°v (Multi-tenancy)

### 2\. üéØ C√≠l F√°ze

C√≠lem je aktivovat **multi-u≈æivatelsk√Ω re≈æim** aplikace.
Vyu≈æijeme datab√°zov√© vztahy `authorId` zaveden√© ve F√°zi 7 k tomu, abychom umo≈ænili roli **KURATOR** spravovat vlastn√≠ "ostrov" obsahu v r√°mci sd√≠len√© administrace, ani≈æ by vidƒõl nebo mohl ovlivnit obsah ostatn√≠ch nebo syst√©mov√° nastaven√≠.

### 3\. Rozsah pro F√°zi 18

  * **Backend (RBAC Logic):** √öprava datab√°zov√Ωch dotaz≈Ø (Prisma) na str√°nk√°ch Dashboardu a Spr√°vy obsahu tak, aby dynamicky filtrovaly data podle role.
  * **Middleware:** √öprava ochrany tras `/admin`, aby pustila dovnit≈ô i roli `KURATOR`.
  * **Frontend (Admin - Spr√°va u≈æivatel≈Ø):** Nov√° str√°nka `/admin/users` pro povy≈°ov√°n√≠ rol√≠ (exkluzivnƒõ pro roli `ADMIN`).
  * **Frontend (UX):** Skryt√≠ glob√°ln√≠ch prvk≈Ø (nap≈ô. odkaz "U≈æivatel√©") pro roli `KURATOR`.

### 4\. üèõÔ∏è N√°vrh ≈òe≈°en√≠ a Architektura

#### 4.1. Spr√°va U≈æivatel≈Ø (`/admin/users`)

  * **Technologie:** Vyu≈æije tabulkov√Ω layout definovan√Ω ve **F√°zi 6** (str√°nka `/admin/manage`).
  * **Funkce:** Seznam u≈æivatel≈Ø s dropdown menu pro zmƒõnu role.
  * **Bezpeƒçnost (Critical):** API endpoint pro zmƒõnu role mus√≠ obsahovat kontrolu: `if (targetUser.id === session.user.id) throw Error("Cannot change own role");`. To zabr√°n√≠ tomu, aby si Admin omylem odebral pr√°va (zku≈°enost z F√°ze 2 - bezpeƒçnostn√≠ pojistky).

#### 4.2. Izolace Dat (The "Author Filter")

Zde aplikujeme logiku z **F√°ze 7**.
V souborech `app/admin/dashboard/page.tsx`, `/manage/page.tsx` a `/collections/page.tsx` uprav√≠me naƒç√≠t√°n√≠ dat:

```typescript
// Pseudo-k√≥d (Best Practice z F√°ze 3 - Server Side Fetching)
const whereClause = session.user.role === 'ADMIN' 
  ? {} // Admin vid√≠ v≈°e
  : { authorId: session.user.id }; // Kur√°tor vid√≠ jen sv√©

const data = await prisma.video.findMany({ where: whereClause });
```

#### 4.3. API Ochrana (CRUD)

Existuj√≠c√≠ API endpointy (`/api/videos/[id]`, `/api/collections`) vytvo≈ôen√© ve **F√°zi 6 a 7** ji≈æ obsahuj√≠ kontrolu:
`if (!isOwner && !isAdmin) return 403;`
**√ökol:** Pouze ovƒõ≈ôit, ≈æe tato logika funguje spr√°vnƒõ i pro novƒõ definovanou roli `KURATOR` v `next-auth` session.

### 5\. üö¶ Funkƒçn√≠ Po≈æadavky (FR)

  * **FR1 (Hierarchie rol√≠):**
      * **USER:** Nem√° p≈ô√≠stup do `/admin`.
      * **KURATOR:** M√° p≈ô√≠stup do `/admin`, m≈Ø≈æe vytv√°≈ôet `Video` a `Collection`. Vid√≠ pouze data, kde `authorId == me`.
      * **ADMIN:** M√° p≈ô√≠stup do `/admin`, vid√≠ v≈°echna data. M√° p≈ô√≠stup do `/admin/users`.
  * **FR2 (Pov√Ω≈°en√≠):** Pouze ADMIN m≈Ø≈æe na str√°nce `/admin/users` zmƒõnit roli jin√©ho u≈æivatele.
  * **FR3 (Vlastnictv√≠):** P≈ôi vytvo≈ôen√≠ obsahu (POST) Kur√°torem se syst√©m automaticky nastav√≠ `authorId` na ID Kur√°tora (toto ji≈æ zaji≈°≈•uje logika z F√°ze 7).

### 6\. üîí Nefunkƒçn√≠ Po≈æadavky (NFR)

  * **NFR1 (Middleware Security):** Konfigurace v `middleware.ts` (zaveden√° ve F√°zi 2) mus√≠ b√Ωt aktualizov√°na, aby podm√≠nka `token.role === 'ADMIN'` byla roz≈°√≠≈ôena na `['ADMIN', 'KURATOR'].includes(token.role)`.
  * **NFR2 (Prevence sebevra≈ædy √∫ƒçtu):** UI i API mus√≠ znemo≈ænit sn√≠≈æen√≠ role vlastn√≠ho √∫ƒçtu (Admin se nem≈Ø≈æe degradovat na Usera).

### 7\. ‚úÖ Akceptaƒçn√≠ Kriteria (Definice "Hotovo")

1.  **Test izolace:**
      * P≈ôihl√°s√≠m se jako Kur√°tor A. Vytvo≈ô√≠m sb√≠rku "A".
      * P≈ôihl√°s√≠m se jako Kur√°tor B. Vytvo≈ô√≠m sb√≠rku "B".
      * Kur√°tor A vid√≠ v administraci jen "A". Kur√°tor B vid√≠ jen "B".
      * Admin vid√≠ "A" i "B".
2.  **Test bezpeƒçnosti:**
      * Kur√°tor A zkus√≠ ruƒçnƒõ zadat URL pro editaci sb√≠rky "B" (`/admin/collections/edit/ID_B`).
      * Syst√©m vyhod√≠ chybu 403 nebo 404 (d√≠ky logice z F√°ze 7).
3.  **Test spr√°vy:**
      * Admin vid√≠ v menu polo≈æku "U≈æivatel√©".
      * Kur√°tor v menu polo≈æku "U≈æivatel√©" nevid√≠.

-----

**Je tato revidovan√° verze, kter√° explicitnƒõ stav√≠ na mechanismech z F√°z√≠ 2, 6 a 7, v souladu s va≈°√≠ p≈ôedstavou?**
------------------------------------------------------------------------

id_chat: 
https://gemini.google.com/u/1/app/98b6fcb93cab23ce


